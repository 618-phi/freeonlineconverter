---
// ConversionOptions component - Format selector and quality settings
---

<div id="conversion-options" class="conversion-options">
  <div class="options-grid">
    <div class="option-group">
      <label for="output-format" class="option-label">
        <svg
          class="label-icon"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"
          />
        </svg>
        Convert to
      </label>
      <select id="output-format" class="option-select">
        <option value="">Select format...</option>
        <option value="jpeg">JPG / JPEG</option>
        <option value="png">PNG</option>
        <option value="webp">WebP</option>
        <option value="gif">GIF</option>
        <option value="bmp">BMP</option>
      </select>
    </div>

    <div class="option-group">
      <label for="quality" class="option-label">
        <svg
          class="label-icon"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"
          />
        </svg>
        Quality
      </label>
      <div class="quality-control">
        <input
          type="range"
          id="quality"
          min="1"
          max="100"
          value="90"
          class="quality-slider"
          aria-label="Quality slider from 1 to 100"
        />
        <span id="quality-value" class="quality-value">90%</span>
      </div>
      <div class="quality-labels">
        <span class="quality-label-text">Lower</span>
        <span class="quality-label-text">Higher</span>
      </div>
    </div>
  </div>

  <button
    id="convert-btn"
    class="btn btn-primary convert-btn"
    disabled
    aria-label="Convert file to selected format"
  >
    <svg
      class="btn-icon"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
      />
    </svg>
    Convert File
  </button>
</div>

<style>
  .conversion-options {
    margin-top: 2rem;
    animation: fadeIn 0.5s ease-out;
  }

  .options-grid {
    display: grid;
    gap: 1.5rem;
    margin-bottom: 1.5rem;
  }

  @media (min-width: 768px) {
    .options-grid {
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }
  }

  .option-group {
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    transition: all 0.3s ease;
  }

  .option-group:hover {
    border-color: var(--accent-primary);
    box-shadow: var(--shadow-md);
  }

  .option-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0.75rem;
    font-size: 0.95rem;
  }

  .label-icon {
    width: 20px;
    height: 20px;
    color: var(--accent-primary);
  }

  .option-select {
    width: 100%;
    background: var(--bg-tertiary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    color: var(--text-primary);
    padding: 0.75rem 1rem;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .option-select:hover {
    border-color: var(--accent-primary);
  }

  .option-select:focus {
    border-color: var(--accent-primary);
    box-shadow: 0 0 0 3px rgba(16, 163, 127, 0.1);
  }

  .quality-control {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 0.5rem;
  }

  .quality-slider {
    flex: 1;
    height: 6px;
    border-radius: 3px;
    background: var(--bg-tertiary);
    outline: none;
    appearance: none;
    cursor: pointer;
  }

  .quality-slider::-webkit-slider-thumb {
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--accent-gradient);
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: var(--shadow-sm);
  }

  .quality-slider::-webkit-slider-thumb:hover {
    transform: scale(1.1);
    box-shadow: var(--shadow-md);
  }

  .quality-slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--accent-gradient);
    cursor: pointer;
    transition: all 0.2s ease;
    box-shadow: var(--shadow-sm);
    border: none;
  }

  .quality-slider::-moz-range-thumb:hover {
    transform: scale(1.1);
    box-shadow: var(--shadow-md);
  }

  .quality-slider::-webkit-slider-runnable-track {
    height: 6px;
    border-radius: 3px;
    background: var(--bg-tertiary);
  }

  .quality-slider::-moz-range-track {
    height: 6px;
    border-radius: 3px;
    background: var(--bg-tertiary);
  }

  .quality-value {
    font-weight: 600;
    color: var(--accent-primary);
    min-width: 50px;
    text-align: right;
  }

  .quality-labels {
    display: flex;
    justify-content: space-between;
  }

  .quality-label-text {
    font-size: 0.75rem;
    color: var(--text-secondary);
  }

  .convert-btn {
    width: 100%;
    padding: 1rem 1.5rem;
    font-size: 1.125rem;
    font-weight: 600;
  }

  .btn-icon {
    width: 20px;
    height: 20px;
  }

  @media (max-width: 640px) {
    .option-group {
      padding: 1rem;
    }

    .convert-btn {
      padding: 0.875rem 1.25rem;
      font-size: 1rem;
    }
  }
</style>

<script>
  const outputFormat = document.getElementById('output-format') as HTMLSelectElement;
  const qualitySlider = document.getElementById('quality') as HTMLInputElement;
  const qualityValue = document.getElementById('quality-value');
  const convertBtn = document.getElementById('convert-btn') as HTMLButtonElement;

  // Update quality display
  qualitySlider?.addEventListener('input', (e) => {
    const value = (e.target as HTMLInputElement).value;
    if (qualityValue) {
      qualityValue.textContent = `${value}%`;
    }
  });

  // Enable convert button when file and format are selected
  function updateConvertButton() {
    const hasFile = (window as any).getSelectedFile?.();
    const hasFormat = outputFormat?.value !== '';

    if (convertBtn) {
      convertBtn.disabled = !hasFile || !hasFormat;
    }
  }

  // Listen for file selection events
  window.addEventListener('fileSelected', updateConvertButton);
  window.addEventListener('fileRemoved', updateConvertButton);
  outputFormat?.addEventListener('change', updateConvertButton);

  // Export conversion settings
  (window as any).getConversionSettings = () => ({
    format: outputFormat?.value || '',
    quality: parseInt(qualitySlider?.value || '90', 10)
  });
</script>
